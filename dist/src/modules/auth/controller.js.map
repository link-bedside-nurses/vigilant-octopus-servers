{"version":3,"file":"controller.js","sourceRoot":"","sources":["../../../../src/modules/auth/controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { HTTPRequest } from '../../adapters/express-callback'\r\nimport { StatusCodes } from 'http-status-codes'\r\nimport { db } from '../../db'\r\nimport { createAccessToken } from '../../services/token/token'\r\nimport { Document } from 'mongoose'\r\nimport { ACCOUNT } from '../../interfaces'\r\nimport * as argon2 from 'argon2'\r\nimport { DESIGNATION } from '../../interfaces/designations'\r\n\r\ninterface SignUpBody {\r\n\tphone: string\r\n\tname: string\r\n\tpassword: string\r\n}\r\n\r\nexport function patientSignup() {\r\n\treturn async function ( request: HTTPRequest<object, {\r\n\t\tphone: string\r\n\t\tname: string\r\n\t\temail: string\r\n\t}> ) {\r\n\t\tconst { phone, name, email } = request.body;\r\n\r\n\t\tconst missingFields = [];\r\n\r\n\t\tif ( !phone ) {\r\n\t\t\tmissingFields.push( 'phone' );\r\n\t\t}\r\n\r\n\t\tif ( !name ) {\r\n\t\t\tmissingFields.push( 'name' );\r\n\t\t}\r\n\r\n\t\tif ( !email ) {\r\n\t\t\tmissingFields.push( 'email' );\r\n\t\t}\r\n\r\n\t\tif ( missingFields.length > 0 ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: `The following fields are missing: ${missingFields.join( ', ' )}`,\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst patient = await db.patients.findOne( { phone } )\r\n\r\n\t\tif ( patient ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Phone number in use',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst user = await db.patients.create( {\r\n\t\t\tphone,\r\n\t\t\tname,\r\n\t\t\temail,\r\n\t\t\tdesignation: DESIGNATION.PATIENT,\r\n\t\t} )\r\n\r\n\t\tawait user.save()\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: user,\r\n\t\t\t\tmessage: 'Account created',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function caregiverSignup() {\r\n\treturn async function ( request: HTTPRequest<object, SignUpBody> ) {\r\n\t\tconst { phone, password, name } = request.body\r\n\r\n\t\tif ( !phone || !password || !name ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Some fields are missing',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst caregiver = await db.caregivers.findOne( { phone } )\r\n\r\n\t\tif ( caregiver ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Phone number in use',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst hash = await argon2.hash( password, {\r\n\t\t\ttype: argon2.argon2id,\r\n\t\t} )\r\n\t\tconst user = await db.caregivers.create( {\r\n\t\t\tphone,\r\n\t\t\tname,\r\n\t\t\tdesignation: DESIGNATION.NURSE,\r\n\t\t\tpassword: hash,\r\n\t\t} )\r\n\r\n\t\tawait user.save()\r\n\r\n\t\tconst accessToken = createAccessToken( user as Document & ACCOUNT )\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: user,\r\n\t\t\t\taccessToken,\r\n\t\t\t\tmessage: 'Account created',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function adminSignup() {\r\n\treturn async function ( request: HTTPRequest<object, {\r\n\t\temail: string\r\n\t\tname: string\r\n\t\tlastName: string\r\n\t\tpassword: string\r\n\t}> ) {\r\n\t\tconst { email, password, name, lastName } = request.body\r\n\r\n\t\tif ( !email || !password || !name || !lastName ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Some fields are missing',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst user = await db.admins.findOne( { email } )\r\n\r\n\t\tif ( user ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'email number in use',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst hash = await argon2.hash( password, {\r\n\t\t\ttype: argon2.argon2id,\r\n\t\t} )\r\n\t\tconst newUser = await db.admins.create( {\r\n\t\t\temail,\r\n\t\t\tname,\r\n\t\t\tlastName,\r\n\t\t\tdesignation: DESIGNATION.ADMIN,\r\n\t\t\tpassword: hash,\r\n\t\t} )\r\n\r\n\t\tawait newUser.save()\r\n\r\n\t\tconst token = createAccessToken( newUser as Document & ACCOUNT )\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: newUser,\r\n\t\t\t\ttoken,\r\n\t\t\t\tmessage: 'Account created',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function patientSignin() {\r\n\treturn async function ( request: HTTPRequest<object, {\r\n\t\tphone: string\r\n\t}> ) {\r\n\t\tconst { phone } = request.body\r\n\r\n\t\tif ( !request.body.phone ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Phone must be specified!',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst user = await db.patients.findOne( { phone } )\r\n\r\n\t\tif ( !user ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.UNAUTHORIZED,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'No such user found',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: null,\r\n\t\t\t\tmessage: 'Success',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function caregiverSignin() {\r\n\treturn async function ( request: HTTPRequest<object, { phone: string, password: string }> ) {\r\n\t\tconst { phone, password } = request.body\r\n\r\n\t\tif ( !phone || !password ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Some fields are missing',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst user = await db.caregivers.findOne( { phone } )\r\n\r\n\t\tif ( !user ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.UNAUTHORIZED,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Invalid Credentials',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst match = await argon2.verify( user.password, password, {\r\n\t\t\ttype: argon2.argon2id,\r\n\t\t} )\r\n\r\n\t\tif ( !match ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.UNAUTHORIZED,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\tmessage: 'Invalid Credentials',\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst accessToken = createAccessToken( user as Document & ACCOUNT )\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: user,\r\n\t\t\t\taccessToken,\r\n\t\t\t\tmessage: 'Signed in',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function adminSignin() {\r\n\treturn async function ( request: HTTPRequest<object, { email: string, password: string }> ) {\r\n\t\tconst { email, password } = request.body\r\n\r\n\t\tif ( !email || !password ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Some fields are missing',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst user = await db.admins.findOne( { email } )\r\n\r\n\t\tif ( !user ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.UNAUTHORIZED,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Invalid Credentials',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst match = await argon2.verify( user.password, password, {\r\n\t\t\ttype: argon2.argon2id,\r\n\t\t} )\r\n\r\n\t\tif ( !match ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.UNAUTHORIZED,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\tmessage: 'Invalid Credentials',\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst accessToken = createAccessToken( user as Document & ACCOUNT )\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: user,\r\n\t\t\t\taccessToken,\r\n\t\t\t\tmessage: 'Signed in',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function deleteAccount() {\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\treturn async function ( _: HTTPRequest<object, object, object> ) {\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: null,\r\n\t\t\t\tmessage: 'account deleted',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function getAccessToken() {\r\n\treturn async function ( request: HTTPRequest<object, object, { designation: DESIGNATION }> ) {\r\n\t\tconst designation = request.query.designation\r\n\r\n\t\tif ( !designation ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Designation must be specified',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet user\r\n\t\tif ( designation === DESIGNATION.PATIENT ) {\r\n\t\t\tuser = await db.patients.findById( request.account?.id )\r\n\t\t} else if ( designation === DESIGNATION.NURSE ) {\r\n\t\t\tuser = await db.caregivers.findById( request.account?.id )\r\n\t\t} else if ( designation === DESIGNATION.ADMIN ) {\r\n\t\t\tuser = await db.caregivers.findById( request.account?.id )\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.UNAUTHORIZED,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmessage: 'Invalid Designation',\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( !user ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatusCode: StatusCodes.BAD_REQUEST,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tdata: user,\r\n\t\t\t\t\tmessage: 'No user found',\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst accessToken = createAccessToken( user as Document & ACCOUNT )\r\n\r\n\t\treturn {\r\n\t\t\tstatusCode: StatusCodes.OK,\r\n\t\t\tbody: {\r\n\t\t\t\tdata: null,\r\n\t\t\t\taccessToken,\r\n\t\t\t\tmessage: 'Access token has been reset!',\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n}\r\n"]}